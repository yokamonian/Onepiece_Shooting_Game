# 원피스 슈팅 게임(Onepiece_Shooting_Game)

## Title : 정상대전

> ####  장르 : 횡스크롤 슈팅
> ####  개발 : 3인
> ####  플렛폼 : PC
> ####  사용 프로그램 : WinAPI, Visual C++
> ####  제작 기간 : 20.05.26 ~ 20.06.02 제작(21.07.25 코드 수정 및 깃허브 커밋)
> ####  간단 설명 : 원피스 리소스를 활용한 횡스크롤 비행 슈팅 게임

## 기능 구현 및 클래스 설명

> + 기능 구현
>   + 컨트롤(Control)
>     + ```이동 및 공격(선택)```
>     + ```캐릭 별 스킬 구현(회피 및 특수기)```
>     + ~~엘리트 유닛, 보스 유닛 패턴 구현(팀원 구현)~~
>     + ~~파워업 아이템 구현(미사일 발사 갯수 증가)(팀원 구현)~~
>   + 캐릭터 선택(3종의 플레이어블 캐릭터 및 캐릭터 선택창 구현)
>   + 씬 매니저
>     + ~~오프닝 씬 ~ 클리어 씬 까지 구현(팀원 구현)~~.
>   + 패턴 매니저
>     + ```각종 패턴 제작을 위한 이동 함수 구현```
>     + ```패턴 매니저를 통하여 탄막류 슈팅 게임에 활용 가능한 이동 패턴을 저장.(웨이브 및 프레임 간 이동 함수들을 저장)```
>   + 기타
>     + ```오브젝트 풀링 패턴을 활용하여 리소스 절약```

## 프로젝트 구조
 + 시스템 디자인(UML)
 ![Onepiece](https://user-images.githubusercontent.com/63716789/129311736-03fcf063-f347-4262-be90-f637ad1f4794.png)
 + 중요코드
   + 오브젝트 풀링(ObjectPooling) 패턴
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134845047-0f7a115d-43f5-4214-a329-8d451a33e7fa.JPG"></p>
     
     + 위 사진은 게임 시작 시 발사에 필요한 미사일들을 벡터에 넣어두는 코드입니다.
     + 미사일 혹은 많은 기체의 생성과 제거에 대한 리소스 처리가 많은 슈팅게임의 특성상 오브젝트 풀링 디자인 패턴이 필요하다 판단되어
       게임 시작시 미사일과 노말 적 기체의 경우 미리 생성 시키고 사용시 저장된 벡터에서 꺼내어 게임 도중 생길 수 있는 과부화를 사전에
       방지하고자 하였습니다.
       
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134845417-9e37dd24-edbf-454f-aaad-30e1d48e31f1.JPG"></p>
     
     + 동일한 과정의 적 일반 기체 생성 과정입니다.
     + 다양한 개체들의 개체수를 다르게 하기 위해 배열에 순서에 맞춰 몬스터 수를 저장하였습니다.
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134845932-ca3e31d9-85f5-44ba-b381-81f07d9d1536.JPG"></p>
     
     + 개체들의 삭제는 게임이 끝난 후 일괄 제거하게 설계되어 있습니다.
     + 위와 같은 과정으로 게임 시작 시 일괄 생성 후, 게임 종료 시 일괄 처리되며 사용되는 부분은 아래의 패턴매니저에서 설명하겠습니다.
     
   + 패턴매니저
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134853320-dc740d5b-44c9-4604-9149-65d95ef5ae17.JPG"></p>
     
     + ActionElement클래스는 한가지 동작을 위한 데이터가 담긴 클래스이고, patternManager는 웨이브 별로 실행되는 복수의 동작들을 저장 및 관리하는 클래스입니다.
     + 게임 시작 시, 오브젝트 풀링의 과정을 거친 뒤 바로 패턴을 저장합니다. 이 부분에서 간편하게 웨이브를 추가할 수 있지만 실행 타이밍은 정해지지 않습니다.
     + 타이밍은 웨이브 순서에 맞춰 자신의 waveID와 비교하는 과정에서 switch문으로 작성된 코드에서 필요한 case에만 패턴을 가져오는 코드를 실행하게 함으로써 조절할
       수 있습니다.
       
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134855201-e3aff43a-dc23-4148-9959-6e14c1f51d6c.JPG"></p>  
      
     + 윗 부분은 순서대로 행동할 패턴을 저장하는 부분입니다.
     + 아래 부분은 그 패턴들을 웨이브에 맞게 저장하는 부분입니다. 풀이하자면 대기모션을 포함하여 총 6개의 동작을 저장하였으며, 마지막 웨이브를 제외한 다른 웨이브에는
       한가지 동작을 실행하고, 마지막에 저장된 웨이브에는 두가지 동작을 실행하게 코딩하였습니다.
     
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134855581-92cbdbf7-207d-4dc9-8a20-49033234e4ba.JPG"></p>
     
     + 이 부분은 enemyManager클래스의 wave 실행 코드입니다. 실행코드라기 보다는 다음 wave에 대한 정보를 다른 오브젝트 클래스들에게 일제히 전달하는 것이 맞겠네요.
     + 이 부분에서 웨이브마다 어떤 타입의 기체를 몇 마리 움직이게 할 것인지 조절 할 수 있습니다.
     + 생성 딜레이나 스폰 위치의 조절이 필요하기 때문에 이중 for문을 사용하였습니다.
     
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134853988-c233c8c7-6372-41a6-a38c-16dfa24752ad.JPG"></p>
     
     + 게임 시작 시, 해당 클래스(일반 적 기체)의 패턴ID는 -1로 초기화 되어 있습니다. 이후 업데이트 과정에서 현재 게임 내의 waveID와 자신의 waveID를 비교하여 일치
       하게 된다면 패턴ID를 +1만큼 증가시키고 해당 웨이브 숫자에 해당하는 패턴 배열에 있는 정보를 바탕으로 움직임을 조정합니다. 이 과정에서 endtime 변수값을 새로이
       패턴이 실행될때마다 지속시간만큼 증가시켜 동작마다 지속시간을 체크하고 동작의 시간이 끝날때마다 패턴ID를 증가시켜서 저장된 패턴의 수보다 크게 되면 다시 패턴
       ID를 음수화하여 비활성화 시키고, 다시금 게임 waveID와 자신의 waveID가 일치할때까지 업데이트 합니다.
     
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134855581-92cbdbf7-207d-4dc9-8a20-49033234e4ba.JPG"></p>  
     
     + 위의 코드로 부터 웨이브id를 전달받은 상태 이후의 코드 입니다. 각각의 오브젝트들은 이벤트 웨이브가 일치하는지 체크하게 됩니다.
     + 일치 하지 않는다면 switch문을 통해 전달받은 waveID에 일치하는 부분은 다음 웨이브의 패턴을 저장하고 그렇지 않은 부분은 패턴을 초기화하게 됩니다.
     + 이후 패턴ID를 -1로 되돌립니다. 이는 패턴을 실행하기 위해 초기값으로 되돌리는 것이고, 이후 waveID를 전달받은 waveID값으로 변경합니다.
     + 위의 과정을 통해 실행이 필요한 웨이브 구간 전 패턴을 저장하고 현재 게임의 웨이브와 자신의 waveID가 일치하면 그때 저장된 패턴을 실행하게 됩니다.
     
     <p align="center"><img src="https://user-images.githubusercontent.com/63716789/134857374-04cd009a-bb84-4d3c-b0a0-564aaf3a34fa.JPG"></p>
     
     + 위의 코드는 waveID가 일치되어 패턴을 실행하는 과정이 담긴 코드입니다.
     + if문 조건에 부합하게 되면 패턴ID값을 1씩 증가시키고, 패턴이 담긴 벡터에 패턴ID값 순서에 의해 패턴이 실행됩니다.
     + 동작은 endtime을 기준으로 지속되며, 월드타임이 endtime보다 클때까지 지속됩니다. 따라서 동작이 실행될때 endtime은 자연스럽게 지속시간만큼 크게되어 지속시간동안
       동작을 실행하게 됩니다.
     + ActionElement 클래스의 변수 id는 실행할 이동 함수의 타입을 나타내며, switch문을 통해 id에 맞는 함수가 저장된 데이터를 바탕으로 실행되는 구조입니다.
       
  끝으로 이 프로젝트를 기점으로 클래스간 상호작용이 많아짐에 따라 UML을 시스템기획서화하여 과정을 설명하는 데 있어 간략하게 하기 위해 과정을 생략하는 부분들이 조금있었습니다.
  그래서 실제 코드의 풀이와 다르게 설명되어진 부분이 있을 수 있습니다.
     
